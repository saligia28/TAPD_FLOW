#!/usr/bin/env python3
from __future__ import annotations
import argparse
import os
import sys

REPO = os.path.dirname(os.path.dirname(os.path.realpath(__file__)))
SRC = os.path.join(REPO, "src")
if SRC not in sys.path:
    sys.path.insert(0, SRC)

from config import load_config  # type: ignore
from notion_wrapper import NotionWrapper  # type: ignore


def main() -> None:
    parser = argparse.ArgumentParser(prog="wipe", description="Clear Notion database (archive all pages)")
    parser.add_argument("-e", "--execute", action="store_true", help="实际执行清空；未加此参数只打印提示")
    parser.add_argument("-d", "--deep", action="store_true", help="递归清空子页面（child_page）")
    args = parser.parse_args()

    cfg = load_config()
    if not args.execute:
        print("[wipe] 干跑模式：未执行。若要实际清空，请追加 -e/--execute")
        return
    notion = NotionWrapper(cfg.notion_token or "", cfg.notion_database_id or "")
    cleared = notion.clear_database(deep=args.deep)
    print(f"[wipe] cleared pages={cleared} | deep={args.deep}")


if __name__ == "__main__":
    main()

